<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>いんぬ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
    }

    #styleToggle {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      z-index: 999;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #styleToggle input {
      margin-right: 5px;
    }
    #styleToggle label {
      margin: 0 10px;
      cursor: pointer;
    }

    #searchBar {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 5px 10px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    #searchInput {
      padding: 4px 8px;
      font-size: 14px;
    }

    #infoPanel {
      position: absolute;
      top: 0;
      right: 0;
      width: 40%;
      max-width: 500px;
      height: 100%;
      background: #748a61;
      box-shadow: -4px 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 10;
    }
    #infoPanel.active {
      transform: translateX(0);
    }
    .country-title {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .filters {
      margin-bottom: 10px;
    }
    .filters label {
      margin-right: 10px;
    }
    .slide {
      display: flex;
      margin-bottom: 20px;
      background: #f5f5f5;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .slide img {
      width: 150px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 15px;
    }
    .slide-content {
      flex: 1;
    }
    .breed-title {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 5px;
    }

    /* 紹介パネル */
    #introPanel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      animation: fadeInIntro 1s ease forwards;
    }

    .intro-content {
      text-align: center;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      font-size: 18px;
    }

    #closeIntro {
      margin-top: 20px;
      font-size: 16px;
      padding: 6px 12px;
      border: none;
      background: #748a61;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    @keyframes fadeInIntro {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOutIntro {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <div id="searchBar">
    <input type="text" id="searchInput" placeholder="犬種を検索" />
    <button onclick="searchBreed()">検索</button>
  </div>

  <div id="styleToggle">
    <label><input type="radio" name="mapStyle" value="light" checked> ホワイト</label>
    <label><input type="radio" name="mapStyle" value="dark"> ダーク</label>
    <label><input type="radio" name="mapStyle" value="colorful"> カラフル</label>
  </div>

  <div id="infoPanel">
    <div class="filters">
      <label>サイズ：
        <select id="sizeFilter">
          <option value="">すべて</option>
          <option value="大型犬">大型犬</option>
          <option value="中型犬">中型犬</option>
          <option value="小型犬">小型犬</option>
        </select>
      </label>
      <label>グループ：
        <select id="groupFilter">
          <option value="">すべて</option>
          <option value="使役犬">使役犬</option>
          <option value="牧羊犬">牧羊犬</option>
          <option value="テリア/ダックス">テリア/ダックス</option>
          <option value="愛玩犬">愛玩犬</option>
          <option value="嗅覚/視覚ハウンド">嗅覚/視覚ハウンド</option>
          <option value="鳥猟犬">鳥猟犬</option>
          <option value="原始の犬/スピッツ">原始の犬/スピッツ</option>
          <option value="その他">その他</option>
        </select>
      </label>
    </div>
    <div id="slidesContainer"></div>
  </div>

  <div id="introPanel">
    <div class="intro-content">
      <h2>犬マップへようこそ！</h2>
      <p>世界各地の犬の品種を地図上で探すことができます。</p>
      <p>ピンをクリックすると、その国の犬種が表示されます。</p> 
      <button id="closeIntro">閉じる</button>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script>
    const dogData = {
      japan: {
        country: '日本',
        dogs: [
          { breed: '秋田犬', size: '大型犬', group: '原始の犬/スピッツ', description: '忠誠心が強く落ち着いた性格。', image: 'akita.jpg' },
          { breed: '柴犬', size: '中型犬', group: '原始の犬/スピッツ', description: '独立心があり活発で忠実。', image: 'shiba.jpg' },
          { breed: '紀州犬', size: '中型犬', group: '原始の犬/スピッツ', description: '猟犬として優れ、静かで我慢強い。', image: 'kishu.jpg' }
        ]
      },
      germany: {
        country: 'ドイツ',
        dogs: [
          { breed: 'ジャーマン・シェパード', size: '大型犬', group: '使役犬', description: '知能が高く警察犬としても活躍。', image: 'gsd.jpg' },
          { breed: 'ダックスフント', size: '小型犬', group: 'テリア/ダックス', description: '短足で胴長、活発で好奇心旺盛。', image: 'dachshund.jpg' },
          { breed: 'ロットワイラー', size: '大型犬', group: '使役犬', description: '力強く勇敢で警備向き。', image: 'rottweiler.jpg' }
        ]
      },
      uk: {
        country: 'イギリス',
        dogs: [
          { breed: 'ラブラドール・レトリーバー', size: '大型犬', group: '鳥猟犬', description: '家庭犬や盲導犬として人気。', image: 'labrador.jpg' },
          { breed: 'ジャック・ラッセル・テリア', size: '小型犬', group: 'テリア/ダックス', description: '小さいがエネルギッシュ。', image: 'jackrussell.jpg' },
          { breed: 'ボーダーコリー', size: '中型犬', group: '牧羊犬', description: '頭がよく活発で人懐っこい。とてもかわいい。', image: 'bordecoll.jpg' }
        ]
      },
      usa: {
        country: 'アメリカ',
        dogs: [
          { breed: 'アメリカン・ピット・ブル・テリア', size: '中型犬', group: 'その他', description: '筋肉質で勇敢。正しい訓練が重要。', image: 'pitbull.jpg' },
          { breed: 'アラスカン・マラミュート', size: '大型犬', group: '原始の犬/スピッツ', description: 'そり引き犬として活躍。友好的で力強い。', image: 'malamute.jpg' }
        ]
      },
      china: {
        country: '中国',
        dogs: [
          { breed: 'チャウチャウ', size: '中型犬', group: '原始の犬/スピッツ', description: 'ライオンのような外見で無口。', image: 'chowchow.jpg' },
          { breed: 'ペキニーズ', size: '小型犬', group: '愛玩犬', description: 'ふわふわで愛らしく、落ち着きがある。', image: 'pekingese.jpg' }
        ]
      }
    };

    const countryCoords = {
      japan: [139.6917, 35.6895],
      germany: [13.4050, 52.5200],
      uk: [-0.1276, 51.5072],
      usa: [-77.0369, 38.9072],
      china: [116.4074, 39.9042]
    };

    let currentStyle = 'light';
    const styleURLs = {
      light: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
      dark: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
      colorful: 'https://demotiles.maplibre.org/style.json'
    };

    const map = new maplibregl.Map({
      container: 'map',
      style: styleURLs[currentStyle],
      center: [140.123, 35.605],
      zoom: 1.5
    });

    document.querySelectorAll('input[name="mapStyle"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        currentStyle = e.target.value;
        map.setStyle(styleURLs[currentStyle]);
      });
    });

    function addMarker(lng, lat, countryKey) {
      const el = document.createElement('div');
      el.className = 'marker';
      el.style.backgroundImage = 'url("mappin.png")';
      el.style.backgroundSize = 'contain';
      el.style.backgroundRepeat = 'no-repeat';
      el.style.width = '60px';
      el.style.height = '60px';
      el.style.cursor = 'pointer';
      el.addEventListener('click', (e) => {
        e.stopPropagation();
        showInfo(countryKey);
        map.flyTo({ center: [lng, lat], zoom: 10 });
      });
      new maplibregl.Marker(el).setLngLat([lng, lat]).addTo(map);
    }

    for (const [key, coord] of Object.entries(countryCoords)) {
      addMarker(coord[0], coord[1], key);
    }

    function showInfo(countryKey) {
      const panel = document.getElementById('infoPanel');
      panel.classList.add('active');
      panel.dataset.country = countryKey;
      renderSlides();
    }

    function renderSlides() {
      const countryKey = document.getElementById('infoPanel').dataset.country;
      const container = document.getElementById('slidesContainer');
      const size = document.getElementById('sizeFilter').value;
      const group = document.getElementById('groupFilter').value;
      const dogs = dogData[countryKey]?.dogs || [];
      container.innerHTML = '<div class="country-title">' + dogData[countryKey]?.country + '</div>';
      const filtered = dogs.filter(d => (!size || d.size === size) && (!group || d.group === group));
      filtered.forEach(dog => {
        container.innerHTML += `
          <div class="slide">
            <img src="${dog.image}" alt="${dog.breed}">
            <div class="slide-content">
              <div class="breed-title">${dog.breed}</div>
              <div>サイズ：${dog.size}</div>
              <div>グループ：${dog.group}</div>
              <div>${dog.description}</div>
            </div>
          </div>`;
      });
    }

    document.getElementById('sizeFilter').addEventListener('change', renderSlides);
    document.getElementById('groupFilter').addEventListener('change', renderSlides);

    map.on('click', () => {
      const panel = document.getElementById('infoPanel');
      panel.classList.remove('active');
      document.getElementById('slidesContainer').innerHTML = '';
      map.flyTo({ center: [140.123, 35.605], zoom: 1.5 });
    });

    // サイト紹介パネル
    document.getElementById('closeIntro').addEventListener('click', function () {
      const intro = document.getElementById('introPanel');
      intro.style.animation = 'fadeOutIntro 1s ease forwards';
      setTimeout(() => {
        intro.style.display = 'none';
      }, 1000);
    });

    // 犬種検索処理
    function searchBreed() {
      const input = document.getElementById('searchInput').value.trim();
      if (!input) return;

      for (const [key, value] of Object.entries(dogData)) {
        const found = value.dogs.find(d => d.breed.includes(input));
        if (found) {
          showInfo(key);
          const coord = countryCoords[key];
          map.flyTo({ center: coord, zoom: 10 });
          return;
        }
      }

      alert('該当する犬種が見つかりませんでした。');
    }
  </script>
</body>
</html>